<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚ªãƒ•ä¼šå‚åŠ ãƒšãƒ¼ã‚¸</title>
</head>

<body>

<h2>ã‚ªãƒ•ä¼šå‚åŠ ãƒ•ã‚©ãƒ¼ãƒ </h2>
<p>ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹äººã ã‘å‚åŠ ã§ãã¾ã™âœ¨</p>

<form id="joinForm">
  <label>
    åå‰:
    <input type="text" id="name" required>
  </label>
  <br><br>

  <label>
    å‚åŠ äººæ•°:
    <input type="number" id="people" min="1" value="1" required>
  </label>
  <br><br>

  <button type="submit">å‚åŠ ã™ã‚‹</button>
</form>

<br>

<button id="logoutBtn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA5KQPd73BJS7k6ueZP8KjyEz78LQfhzek",
  authDomain: "offline-meet-up.firebaseapp.com",
  projectId: "offline-meet-up",
  storageBucket: "offline-meet-up.firebasestorage.app",
  messagingSenderId: "834362010778",
  appId: "1:834362010778:web:4af33334a26024f3cfc323",
  measurementId: "G-BX7SWWG5T5"
};

const app = initializeApp(firebaseConfig);
getAnalytics(app);

const auth = getAuth(app);
const db = getFirestore(app);

// ğŸ”’ ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯
onAuthStateChanged(auth, (user) => {
  if (!user || !user.emailVerified) {
    location.href = "login.html";
  }
});

// ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
document.getElementById("logoutBtn").onclick = async () => {
  await signOut(auth);
  location.href = "login.html";
};

// ğŸ“ å‚åŠ ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
document.getElementById("joinForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = document.getElementById("name").value.trim();
  const people = Number(document.getElementById("people").value);

  if (!name || people < 1) {
    alert("æ­£ã—ãå…¥åŠ›ã—ã¦ã­");
    return;
  }

  await addDoc(collection(db, "participants"), {
    name,
    people,
    timestamp: serverTimestamp(),
    userId: auth.currentUser.uid
  });

  alert("å‚åŠ ç™»éŒ²å®Œäº†âœ¨");
  e.target.reset();
});
</script>

<!-- tawk.to chatï¼ˆ1å›ã ã‘ãƒ»æ­£ã—ã„IDï¼‰ -->
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/6979b443f957841983b37d8b/1jg1mgaaa';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>

</body>
</html>
